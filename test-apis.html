<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .section { border: 1px solid #ddd; margin: 20px 0; padding: 20px; border-radius: 8px; }
        .section h3 { margin-top: 0; color: #333; }
        input, textarea, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 20px; margin: 10px 5px 10px 0; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin: 10px 0; }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 12px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ¥ ì¹˜ë§¤ì•ˆì‹¬ì„¼í„° API ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
    
    <!-- íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸ -->
    <div class="section">
        <h3>ğŸ‘¤ íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸</h3>
        <div class="form-group">
            <label>ì´ë©”ì¼:</label>
            <input type="email" id="registerEmail" placeholder="test@example.com">
        </div>
        <div class="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸:</label>
            <input type="password" id="registerPassword" placeholder="password123">
        </div>
        <div class="form-group">
            <label>ì´ë¦„:</label>
            <input type="text" id="registerName" placeholder="í™ê¸¸ë™">
        </div>
        <div class="form-group">
            <label>ì „í™”ë²ˆí˜¸:</label>
            <input type="text" id="registerPhone" placeholder="010-1234-5678">
        </div>
        <div class="form-group">
            <label>ì£¼ì†Œ:</label>
            <input type="text" id="registerAddress" placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬...">
        </div>
        <div class="form-group">
            <label>ì‚¬ìš©ì íƒ€ì…:</label>
            <select id="registerUserType">
                <option value="caregiver">ë³´í˜¸ì</option>
                <option value="patient">í™˜ì</option>
            </select>
        </div>
        <button onclick="testRegister()">íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸</button>
        <div id="registerResult" class="result" style="display:none;"></div>
    </div>
    
    <!-- ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ -->
    <div class="section">
        <h3>ğŸ” ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h3>
        <div class="form-group">
            <label>ì´ë©”ì¼:</label>
            <input type="email" id="loginEmail" placeholder="test@example.com">
        </div>
        <div class="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸:</label>
            <input type="password" id="loginPassword" placeholder="password123">
        </div>
        <button onclick="testLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
        <div id="loginResult" class="result" style="display:none;"></div>
    </div>
    
    <!-- ë¬¼í’ˆ ì‹ ì²­ í…ŒìŠ¤íŠ¸ -->
    <div class="section">
        <h3>ğŸ“¦ ë¬¼í’ˆ ì‹ ì²­ í…ŒìŠ¤íŠ¸</h3>
        <div class="form-group">
            <label>ì‚¬ìš©ì ID:</label>
            <input type="number" id="applicationUserId" placeholder="1" value="1">
        </div>
        <div class="form-group">
            <label>ìƒí’ˆ ID:</label>
            <input type="number" id="applicationProductId" placeholder="1" value="1">
        </div>
        <div class="form-group">
            <label>ìˆ˜ëŸ‰:</label>
            <input type="number" id="applicationQuantity" placeholder="1" value="1">
        </div>
        <div class="form-group">
            <label>ë°°ì†¡ ì£¼ì†Œ:</label>
            <input type="text" id="applicationAddress" placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
        </div>
        <div class="form-group">
            <label>ìš”ì²­ì‚¬í•­:</label>
            <textarea id="applicationNote" placeholder="ë°°ì†¡ ì‹œ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
        <button onclick="testApplication()">ë¬¼í’ˆ ì‹ ì²­ í…ŒìŠ¤íŠ¸</button>
        <div id="applicationResult" class="result" style="display:none;"></div>
    </div>
    
    <!-- ì‹ ì²­ ë‚´ì—­ ì¡°íšŒ -->
    <div class="section">
        <h3>ğŸ“‹ ì‹ ì²­ ë‚´ì—­ ì¡°íšŒ</h3>
        <div class="form-group">
            <label>ì‚¬ìš©ì ID:</label>
            <input type="number" id="myApplicationsUserId" placeholder="1" value="1">
        </div>
        <button onclick="testMyApplications()">ë‚´ ì‹ ì²­ ë‚´ì—­ ì¡°íšŒ</button>
        <div id="myApplicationsResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_BASE = 'https://dementia-care-backend-production.up.railway.app';
        
        // íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸
        async function testRegister() {
            try {
                showLoading('registerResult', 'íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘...');
                
                const data = {
                    email: document.getElementById('registerEmail').value,
                    password: document.getElementById('registerPassword').value,
                    name: document.getElementById('registerName').value,
                    phone: document.getElementById('registerPhone').value,
                    address: document.getElementById('registerAddress').value,
                    user_type: document.getElementById('registerUserType').value
                };
                
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showResult('registerResult', result, response.ok);
                
                if (response.ok) {
                    // ì„±ê³µ ì‹œ ì‚¬ìš©ì ìŠ¹ì¸ ì²˜ë¦¬ (í…ŒìŠ¤íŠ¸ìš©)
                    await approveUser(result.user_id);
                }
                
            } catch (error) {
                showResult('registerResult', { error: error.message }, false);
            }
        }
        
        // ì‚¬ìš©ì ìŠ¹ì¸ ì²˜ë¦¬ (í…ŒìŠ¤íŠ¸ìš©)
        async function approveUser(userId) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/approve-user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, action: 'approve' })
                });
                
                if (response.ok) {
                    console.log('ì‚¬ìš©ì ìë™ ìŠ¹ì¸ ì™„ë£Œ');
                }
            } catch (error) {
                console.log('ìë™ ìŠ¹ì¸ ì‹¤íŒ¨:', error.message);
            }
        }
        
        // ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
        async function testLogin() {
            try {
                showLoading('loginResult', 'ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...');
                
                const data = {
                    email: document.getElementById('loginEmail').value,
                    password: document.getElementById('loginPassword').value
                };
                
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showResult('loginResult', result, response.ok);
                
            } catch (error) {
                showResult('loginResult', { error: error.message }, false);
            }
        }
        
        // ë¬¼í’ˆ ì‹ ì²­ í…ŒìŠ¤íŠ¸
        async function testApplication() {
            try {
                showLoading('applicationResult', 'ë¬¼í’ˆ ì‹ ì²­ ì²˜ë¦¬ ì¤‘...');
                
                const data = {
                    user_id: parseInt(document.getElementById('applicationUserId').value),
                    product_id: parseInt(document.getElementById('applicationProductId').value),
                    quantity: parseInt(document.getElementById('applicationQuantity').value),
                    delivery_address: document.getElementById('applicationAddress').value,
                    request_note: document.getElementById('applicationNote').value
                };
                
                const response = await fetch(`${API_BASE}/api/applications`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showResult('applicationResult', result, response.ok);
                
            } catch (error) {
                showResult('applicationResult', { error: error.message }, false);
            }
        }
        
        // ì‹ ì²­ ë‚´ì—­ ì¡°íšŒ í…ŒìŠ¤íŠ¸
        async function testMyApplications() {
            try {
                showLoading('myApplicationsResult', 'ì‹ ì²­ ë‚´ì—­ ì¡°íšŒ ì¤‘...');
                
                const userId = document.getElementById('myApplicationsUserId').value;
                const response = await fetch(`${API_BASE}/api/applications/my/${userId}`);
                const result = await response.json();
                showResult('myApplicationsResult', result, response.ok);
                
            } catch (error) {
                showResult('myApplicationsResult', { error: error.message }, false);
            }
        }
        
        // ë¡œë”© í‘œì‹œ
        function showLoading(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result';
            element.innerHTML = `<p>${message}</p>`;
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function showResult(elementId, result, isSuccess) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
            element.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }
    </script>
</body>
</html>