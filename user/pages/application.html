<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>조호물품 신청 - 치매안심센터</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <style>
        /* 물품분류 스타일 - 장바구니 스타일 제거함 */
        .category-sidebar {
            width: 250px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .category-sidebar h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: var(--text-color);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-sidebar ul {
            padding: 0;
        }
        
        .category-sidebar ul li {
            margin-bottom: 12px;
        }
        
        .category-sidebar ul li a {
            display: block;
            padding: 8px 15px;
            color: var(--text-color);
            border-radius: 30px;
            transition: all 0.3s;
        }
        
        .category-sidebar ul li a:hover {
            background-color: #f0f0f0;
        }
        
        .category-sidebar ul li a.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .product-category {
            display: flex;
            gap: 20px;
        }
        
        .product-container {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
        }
        
        .product-item {
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn-apply {
            width: 80%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 auto;
        }
        
        .text-center {
            text-align: center;
        }

        /* 숫자 입력 화살표 제거 - 모든 브라우저 호환 */
        /* Chrome, Safari, Edge, Opera에서 화살표 제거 */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox에서 화살표 제거 */
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 영역 -->
<header>
    <div class="header-top">
        <div class="utility-menu">
            <a href="login.html">로그인</a>
            <a href="register.html">회원가입</a>
            <a href="customer-service.html">고객센터</a>
        </div>
    </div>
    <div class="header-main">
        <div class="logo">
            <a href="../index.html"><img src="../images/logo.png" alt="치매안심센터 로고" onerror="this.src='https://via.placeholder.com/150x50?text=로고'"></a>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="필요하신 조호물품을 검색해보세요">
            <button type="submit">검색하기</button>
        </div>
        <div class="header-icons">
            <a href="mypage.html" class="icon my-page"><span>신청내역</span></a>
            <a href="myinfo.html" class="icon user"><span>내정보</span></a>
            <a href="cart.html" class="icon cart" data-count="0"><span>장바구니</span></a>
        </div>
    </div>
    <!-- 네비게이션 메뉴 -->
    <nav>
        <ul class="main-nav">
            <li><a href="application.html">조호물품 신청</a></li>
            <li><a href="guide.html">이용안내</a></li>
            <li><a href="info.html">자주하는 질문</a></li>
            <li><a href="notice.html">공지사항</a></li>
        </ul>
    </nav>
</header>

        <!-- 메인 콘텐츠 영역 -->
        <main>
            <section class="page-header">
                <h1>조호물품 신청</h1>
            </section>

            <section class="product-category">
                <div class="category-sidebar">
                    <h3>조호물품 카테고리</h3>
                    <ul>
                        <li><a href="#" class="active" data-category="all">전체 조호물품</a></li>
                        <li><a href="#" data-category="hygiene">위생용품 (12)</a></li>
                        <li><a href="#" data-category="daily">생활용품 (8)</a></li>
                        <li><a href="#" data-category="meal">식사용품 (6)</a></li>
                        <li><a href="#" data-category="safety">안전용품 (5)</a></li>
                        <li><a href="#" data-category="rehab">재활용품 (4)</a></li>
                    </ul>
                </div>

                <div class="product-container">
                    <!-- 1번 상품: 성인용 기저귀 -->
                    <div class="product-item" data-category="hygiene" data-id="1">
                        <img src="../images/product1.jpg" alt="성인용 기저귀" onerror="this.src='https://via.placeholder.com/200x200?text=성인용기저귀'">
                        <h3>성인용 기저귀</h3>
                        <p>중형 (20매)</p>
                        <button class="btn-apply" data-id="1">신청하기</button>
                    </div>
                    
                    <!-- 2번 상품: 조호용 물티슈 -->
                    <div class="product-item" data-category="hygiene" data-id="2">
                        <img src="../images/product2.jpg" alt="조호용 물티슈" onerror="this.src='https://via.placeholder.com/200x200?text=조호용물티슈'">
                        <h3>조호용 물티슈</h3>
                        <p>대형 (100매)</p>
                        <button class="btn-apply" data-id="2">신청하기</button>
                    </div>
                    
                    <!-- 3번 상품: 방수 매트 -->
                    <div class="product-item" data-category="daily" data-id="3">
                        <img src="../images/product3.jpg" alt="방수 매트" onerror="this.src='https://via.placeholder.com/200x200?text=방수매트'">
                        <h3>방수 매트</h3>
                        <p>침대용 (17매)</p>
                        <button class="btn-apply" data-id="3">신청하기</button>
                    </div>
                    
                    <!-- 4번 상품: 목욕용품 세트 -->
                    <div class="product-item" data-category="hygiene" data-id="4">
                        <img src="../images/product4.jpg" alt="목욕용품" onerror="this.src='https://via.placeholder.com/200x200?text=목욕용품'">
                        <h3>목욕용품 세트</h3>
                        <p>종합 세트 (1박스)</p>
                        <button class="btn-apply" data-id="4">신청하기</button>
                    </div>
                    
                    <!-- 5번 상품: 항균 손소독제 -->
                    <div class="product-item" data-category="hygiene" data-id="5">
                        <img src="../images/product5.jpg" alt="손소독제" onerror="this.src='https://via.placeholder.com/200x200?text=손소독제'">
                        <h3>항균 손소독제</h3>
                        <p>500ml (2개)</p>
                        <button class="btn-apply" data-id="5">신청하기</button>
                    </div>
                    
                    <!-- 6번 상품: 일회용 장갑 -->
                    <div class="product-item" data-category="safety" data-id="6">
                        <img src="../images/product6.jpg" alt="일회용장갑" onerror="this.src='https://via.placeholder.com/200x200?text=일회용장갑'">
                        <h3>일회용 장갑</h3>
                        <p>100매 (1박스)</p>
                        <button class="btn-apply" data-id="6">신청하기</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- 푸터 영역 -->
        <footer>
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="../images/logo.png" alt="치매안심센터 로고" onerror="this.src='https://via.placeholder.com/120x40?text=로고'">
                </div>
                <div class="footer-info">
                    <p>치매안심센터 | 주소: 서울특별시 종로구 종로1길 1 | 대표전화: 02-123-4567</p>
                    <p>Copyright © 2025 치매안심센터 조호물품 신청 서비스. All rights reserved.</p>
                </div>
                <div class="footer-links">
                    <a href="#">개인정보처리방침</a>
                    <a href="#">이용약관</a>
                    <a href="#">사이트맵</a>
                </div>
            </div>
        </footer>
    </div>

<!-- 기존 스크립트 교체 -->
<script src="../js/main.js"></script>
<script src="../js/api.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 인증 확인
    if (!checkAuth()) return;
    
    let products = [];
    
    // 조호물품 목록 로드
    async function loadProducts() {
        try {
            const result = await getProducts();
            if (result.success) {
                products = result.data;
                displayProducts(products);
            }
        } catch (error) {
            console.error('상품 로드 에러:', error);
            showError('상품 목록을 불러오는데 실패했습니다.');
        }
    }
    
    // 상품 목록 표시
    function displayProducts(productList) {
        const productGrid = document.querySelector('.product-grid');
        if (!productGrid) return;
        
        productGrid.innerHTML = productList.map(product => `
            <div class="product-item" data-category="${product.category}" data-id="${product.id}">
                <img src="${product.image_url}" alt="${product.name}" 
                     onerror="this.src='https://via.placeholder.com/200x200?text=${encodeURIComponent(product.name)}'">
                <h3>${product.name}</h3>
                <p>${product.description}</p>
                <p class="product-limit">월 최대 ${product.max_quantity_per_month}개</p>
                <button class="btn-apply" data-id="${product.id}">신청하기</button>
            </div>
        `).join('');
        
        // 신청 버튼 이벤트 추가
        addApplyButtonEvents();
    }
    
    // 신청 버튼 이벤트 추가
    function addApplyButtonEvents() {
        const applyButtons = document.querySelectorAll('.btn-apply');
        applyButtons.forEach(button => {
            button.addEventListener('click', function() {
                const productId = parseInt(this.dataset.id);
                const product = products.find(p => p.id === productId);
                if (product) {
                    openApplicationModal(product);
                }
            });
        });
    }
    
    // 신청 모달 열기
    function openApplicationModal(product) {
        // 간단한 프롬프트로 신청 정보 받기 (나중에 예쁜 모달로 교체 가능)
        const quantity = prompt(`${product.name} 신청 수량을 입력하세요 (최대 ${product.max_quantity_per_month}개):`, '1');
        
        if (quantity === null) return; // 취소
        
        const quantityNum = parseInt(quantity);
        if (isNaN(quantityNum) || quantityNum < 1 || quantityNum > product.max_quantity_per_month) {
            showError(`수량은 1개 이상 ${product.max_quantity_per_month}개 이하로 입력해주세요.`);
            return;
        }
        
        const address = prompt('배송 주소를 입력해주세요:', currentUser.address || '');
        
        if (address === null) return; // 취소
        
        if (!address.trim()) {
            showError('배송 주소를 입력해주세요.');
            return;
        }
        
        const note = prompt('요청사항을 입력하세요 (선택사항):', '') || '';
        
        // 신청 처리
        submitApplication(product.id, quantityNum, address, note);
    }
    
    // 신청 처리
    async function submitApplication(productId, quantity, address, note) {
        try {
            const applicationData = {
                user_id: currentUser.id,
                product_id: productId,
                quantity: quantity,
                delivery_address: address,
                request_note: note
            };
            
            const result = await applyForProduct(applicationData);
            
            if (result.success) {
                showSuccess(`${result.message}\n신청번호: ${result.application_id}`);
            } else {
                throw new Error(result.error || '신청 처리에 실패했습니다.');
            }
            
        } catch (error) {
            console.error('신청 에러:', error);
            showError(error.message);
        }
    }
    
    // 카테고리 필터 기능
    const categoryButtons = document.querySelectorAll('.category-filter button');
    categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
            // 활성 버튼 변경
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            const category = this.dataset.category;
            
            if (category === 'all') {
                displayProducts(products);
            } else {
                const filteredProducts = products.filter(p => p.category === category);
                displayProducts(filteredProducts);
            }
        });
    });
    
    // 페이지 로드 시 상품 목록 로드
    loadProducts();
});
</script>
</body>
</html>